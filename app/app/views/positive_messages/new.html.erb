<%= render 'shared/subheader', headline: 'Participantes', levels: ['Anjos do Superação, Participantes'] %>
<script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>


<div class="wrapper wrapper-content  animated fadeInRight">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title"><h5>Criar mensagem positiva</h5></div>
        <div class="ibox-content">

          <%= simple_form_for @positive_message, url: positive_messages_path, html: {multipart: true} do |f| %>
            <%= f.error_notification %>
            <%= f.input :name  %>
            <%= f.input :image, as: :file, input_html: {id: 'file'}  %>
            <%= f.button :submit, 'Enviar', class: 'btn btn-primary' %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAwCcD7oirM83Jq8bIQpjZVO_8DKfCmv1c",
    authDomain: "superacao-6ef6d.firebaseapp.com",
    databaseURL: "https://superacao-6ef6d.firebaseio.com",
    storageBucket: "superacao-6ef6d.appspot.com",
    messagingSenderId: "606286481895"
  };
  firebase.initializeApp(config);

  var auth = firebase.auth();
  var storageRef = firebase.storage().ref();

  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    var file = evt.target.files[0];
    var metadata = {
      'contentType': file.type
    };
    // Push to child path.
    // [START oncomplete]
    storageRef.child('images/' + file.name).put(file, metadata).then(function(snapshot) {
      console.log('Uploaded', snapshot.totalBytes, 'bytes.');
      console.log(snapshot.metadata);
      var url = snapshot.downloadURL;
      console.log('File available at', url);
      // [START_EXCLUDE]
      document.getElementById('linkbox').innerHTML = '<a href="' +  url + '">Click For File</a>';
      // [END_EXCLUDE]
    }).catch(function(error) {
      // [START onfailure]
      console.error('Upload failed:', error);
      // [END onfailure]
    });
    // [END oncomplete]
  }
  window.onload = function() {
    document.getElementById('file').addEventListener('change', handleFileSelect, false);
    document.getElementById('file').disabled = true;
    auth.onAuthStateChanged(function(user) {
      if (user) {
        console.log('Anonymous user signed-in.', user);
        document.getElementById('file').disabled = false;
      } else {
        console.log('There was no anonymous session. Creating a new anonymous user.');
        // Sign the user in anonymously since accessing Storage requires the user to be authorized.
        auth.signInAnonymously();
      }
    });
  }
</script>
